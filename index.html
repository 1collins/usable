<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Unico Kitchen â€” Recipes, Shop & Gas</title>
<style>
  :root{--accent:#ff6b35;--muted:#666;--bg:#fafafa}
  *{box-sizing:border-box}
  body{margin:0;font-family:Arial,system-ui,sans-serif;background:var(--bg);color:#111}
  header{background:#fff;padding:12px;box-shadow:0 2px 8px rgba(0,0,0,.06);position:sticky;top:0;z-index:60}
  .container{max-width:1000px;margin:0 auto;padding:12px}
  .header-row{display:flex;align-items:center;gap:12px}
  .brand{font-weight:800;color:var(--accent);font-size:18px}
  .tabs{margin-left:20px;display:flex;gap:8px}
  .tab{padding:8px 10px;border-radius:8px;cursor:pointer}
  .tab.active{background:#fff;border:1px solid #eee;box-shadow:0 2px 8px rgba(0,0,0,.04)}
  .actions{margin-left:auto;display:flex;gap:8px;align-items:center}
  .count{background:var(--accent);color:#fff;padding:6px 10px;border-radius:999px;font-weight:700}
  button{cursor:pointer;border:none;padding:8px 10px;border-radius:8px;background:var(--accent);color:#fff}
  .ghost{background:#eee;color:#111}
  main{padding:18px}
  .quickbar{background:#fff;padding:8px 12px;border-bottom:1px solid #f3f3f3;display:flex;gap:12px;align-items:center;justify-content:center}
  .quick-item{display:flex;gap:8px;align-items:center;background:#fff;padding:6px;border-radius:8px;border:1px solid #f0f0f0}
  .blink{ animation: blinkAnim .9s ease-in-out; }
  @keyframes blinkAnim { 0%{transform:scale(1)}50%{transform:scale(1.06)}100%{transform:scale(1)} }
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px}
  .card{background:#fff;padding:12px;border-radius:10px;box-shadow:0 4px 18px rgba(0,0,0,.04)}
  .card img{width:100%;height:150px;object-fit:cover;border-radius:8px}
  .buttons{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .hidden{display:none}
  .shop-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px}
  .shop-item img{height:110px;width:100%;object-fit:cover;border-radius:8px}
  .cart-panel{position:fixed;right:16px;bottom:16px;background:#fff;padding:12px;border-radius:10px;box-shadow:0 14px 40px rgba(0,0,0,.12);width:320px;max-height:70vh;overflow:auto;z-index:70}
  .ingredient-row{display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px dashed #f0f0f0}
  footer{padding:16px;text-align:center;color:var(--muted);font-size:13px}
  input[type=number]{padding:6px;border:1px solid #eee;border-radius:6px}
  small.note{color:var(--muted);display:block;margin-top:6px}
  .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:90px;background:#222;color:#fff;padding:10px 14px;border-radius:8px;box-shadow:0 8px 30px rgba(0,0,0,.2);opacity:0;transition:opacity .25s,transform .25s;z-index:999}
  .toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
  @media (max-width:720px){ .grid{grid-template-columns:1fr} .tabs{display:none} .cart-panel{width:92%;right:4%} .quickbar{flex-direction:column;gap:8px} }
</style>
</head>
<body>

<header>
  <div class="container header-row">
    <div style="display:flex;align-items:center;gap:12px">
      <!-- LOGO: change the src to your own uploaded image (recommended to upload to repo and use raw.githubusercontent url or relative path) -->
      <img id="logo" src="https://chatgpt.com/backend-api/estuary/content?id=file_000000000be46243bf003c9c16ca6bd8&ts=489056&p=fs&cid=1&sig=47850247fa0cf989f007af960a690ab0e8320ab43338b560e3837b4c507e6078&v=0" alt="logo" style="width:56px;height:56px;border-radius:10px;object-fit:cover">
      <div>
        <div class="brand">Unico Kitchen</div>
        <small class="note">You cook â€” we follow (recipes, shop & gas)</small>
      </div>
    </div>

    <nav class="tabs" id="navTabs" aria-label="Main tabs">
      <div class="tab active" data-tab="recipes">Recipes</div>
      <div class="tab" data-tab="shop">Shop</div>
      <div class="tab" data-tab="gas">Gas</div>
      <div class="tab" data-tab="fridge">Fridge</div>
    </nav>

    <div class="actions">
      <div id="cartCount" class="count">0</div>
      <button id="openCartBtn" class="ghost">Cart</button>
      <button id="sendOrderHeader" class="ghost">Send Order</button>
      <button id="sendPlanHeader" class="ghost">Send Plan</button>
    </div>
  </div>

  <div class="quickbar container" id="quickBar">
    <div style="font-weight:700;color:var(--muted)">Quick Buy:</div>
    <div id="quickItems" style="display:flex;gap:8px;align-items:center"></div>
    <div style="display:flex;gap:8px;align-items:center;margin-left:8px">
      <label style="font-size:14px">Quick Gas:</label>
      <input id="quickGasQty" type="number" min="1" value="1" style="width:70px;padding:6px;border-radius:6px;border:1px solid #eee">
      <button id="quickAddGas" class="">Add Gas</button>
    </div>
  </div>
</header>

<main class="container">
  <section id="recipes" class="tab-panel">
    <h2>All Recipes</h2>
    <small class="note">Click "Cook (WhatsApp)" to send a friendly recipe message (no prices).</small>
    <div id="recipesGrid" class="grid" style="margin-top:12px"></div>
  </section>

  <section id="shop" class="tab-panel hidden">
    <h2>Shop</h2>
    <small class="note">Add shop items (priced) to the cart; Add to Fridge saves ingredients (no price).</small>
    <div id="shopGrid" class="shop-grid" style="margin-top:12px"></div>
  </section>

  <section id="gas" class="tab-panel hidden">
    <h2>Gas Tokens</h2>
    <div style="background:#fff;padding:12px;border-radius:8px">
      <p class="note">Each gas minute = 1 token. Change token price in CONFIG below if needed.</p>
      <div style="display:flex;gap:10px;align-items:center">
        <label>Tokens: <input id="gasQty" type="number" min="1" value="1" style="width:80px"></label>
        <div>Price/token: <strong id="tokenPrice">50</strong> KES</div>
        <button id="addGas">Add</button>
      </div>
      <div style="margin-top:8px">Estimated: <strong id="gasTotal">50</strong> KES</div>
    </div>
  </section>

  <section id="fridge" class="tab-panel hidden">
    <h2>Your Fridge</h2>
    <small class="note">Saved ingredients (no prices). Click "View in shop" to jump to the shop item.</small>
    <div id="fridgeList" style="margin-top:12px"></div>
  </section>
</main>

<div id="cartPanel" class="cart-panel" style="display:none" aria-live="polite">
  <h3 style="margin:0 0 8px">Cart</h3>
  <div id="cartItems"></div>
  <div style="margin-top:12px;display:flex;justify-content:space-between;align-items:center">
    <div><strong>Total:</strong> <span id="cartTotal">0</span> KES</div>
    <div style="display:flex;gap:8px">
      <button id="clearCart" class="ghost">Clear</button>
      <button id="sendCart">Send Order</button>
    </div>
  </div>
</div>

<div id="toast" class="toast" role="status" aria-live="polite"></div>

<footer>Built for Unico Kitchen â€” edit logo, phone, recipes and shop items in the JS below.</footer>

<script>
/* ============================
   CONFIG â€” edit these values
   ============================ */
const CONFIG = {
  PHONE: '254798459336',        // <-- your WhatsApp number (international, no +)
  TOKEN_PRICE: 50,              // <-- price per gas token (KES)
  featuredShopIds: ['rice1','noodles1','oil1'] // quick bar items (use shop item ids)
};

/* ============================
   RECIPES â€” keep or edit here
   (These are the recipes you provided earlier)
   ============================ */
const recipes = [
  /* (Same recipes list as provided earlier. For brevity they are included below.)
     If you need to add or edit recipes later, change the array here. */
  {
    id: 'chicken-pilau',
    title: 'Chicken Pilau',
    image: 'https://img-global.cpcdn.com/recipes/cefe9d01076b938b/300x426f0.5_0.56875_1.0q80/chicken-pilau-recipe-main-photo.webp',
    ingredients: [
      { name: '3 cups basmati rice', shopId: 'rice1' },
      { name: '2 tbsn pilau masala', shopId: 'pilau-spice' },
      { name: 'Onions', shopId: 'onion1' },
      { name: 'Salt', shopId: 'salt1' },
      { name: 'Garlic ginger paste', shopId: 'garlic1' },
      { name: '6 cups hot water' },
      { name: '2 kg chicken pieces', shopId: 'chicken1' }
    ],
    steps: [
      'Fry lots of onions till black in color (this is the secret to a colorful and tasty pilau). Keep stirring to avoid them getting burnt.',
      'Add garlic ginger paste and stir till fragrant then add the pilau masala spice and salt.',
      'Stir in the pre-baked chicken and cook for about 5 min to infuse the flavors.',
      'Add rice, water and cook on medium heat till the water evaporates.',
      'Enjoy.'
    ]
  },

  /* Additional recipes (ugali, pancakes, biryani, etc.) - copy/paste or edit as needed */
  {
    id: 'beef-pilau',
    title: 'Beef Pilau',
    image: 'https://img-global.cpcdn.com/recipes/1b7f76052ea23f19/300x426cq80/beef-pilau-recipe-main-photo.webp',
    ingredients: [
      { name: '2 cups rice', shopId: 'rice1' },
      { name: '150 g boiled beef' },
      { name: 'Pilau masala', shopId: 'pilau-spice' },
      { name: '2 large chopped onion', shopId: 'onion1' },
      { name: '2 tbs garlic paste', shopId: 'garlic1' },
      { name: '1 tbs ginger paste' },
      { name: '3 tbs cooking oil', shopId: 'oil1' },
      { name: '4 cups boiled water / bone broth' },
      { name: 'Salt' }
    ],
    steps: [
      'In a pan add the cooking oil and the chopped onions.',
      'Cook until lightly brown, add ginger and garlic paste.',
      'Cook until golden brown; add boiled beef, pilau masala, salt and rice.',
      'Add bone broth / water and cook under low heat until rice is done.',
      'Serve and enjoy.'
    ]
  },

  /* add other recipes from your list (ugali, biryani, pancakes etc.) as you prefer */
  {
    id: 'ugali-basic',
    title: 'Ugali (Basic)',
    image: 'https://img-global.cpcdn.com/recipes/260568fdfcdfb88c/300x426cq80/ugali-recipe-main-photo.webp',
    ingredients: [
      { name: 'Maize flour', shopId: 'maize1' },
      { name: 'Water' }
    ],
    steps: [
      'Boil water in a deep pan.',
      'Add maize flour slowly while stirring vigorously with a wooden spoon.',
      'Cook until firm and serve.'
    ]
  }

  // add remaining recipes here...
];

/* ============================
   SHOP ITEMS â€” REPLACED WITH YOUR PROVIDED URLs
   You asked that only the shop tap content be changed: the images below are your raw.githubusercontent URLs.
   If you want to edit item names or prices, change the `name` or `price` for each object.
   Keep the `id` consistent with recipe ingredient.shopId or recipes will not map automatically.
   ============================ */
const shopItems = [
  { id:'rice1',      name:'Basmati Rice 2kg',       price:200, image:'https://raw.githubusercontent.com/1collins/image/e88660bef9ec7d9770d55454ac4a1157a51ecca2/collins%20var/IMG-20251020-WA0001.jpg' },
  { id:'pilau-spice',name:'Pilau Masala 100g',     price:60,  image:'https://raw.githubusercontent.com/1collins/image/e88660bef9ec7d9770d55454ac4a1157a51ecca2/collins%20var/IMG-20251020-WA0002.jpg' },
  { id:'onion1',     name:'Onions 1kg',            price:60,  image:'https://raw.githubusercontent.com/1collins/image/e88660bef9ec7d9770d55454ac4a1157a51ecca2/collins%20var/IMG-20251020-WA0003.jpg' },
  { id:'salt1',      name:'Salt 1kg',              price:30,  image:'https://raw.githubusercontent.com/1collins/image/e88660bef9ec7d9770d55454ac4a1157a51ecca2/collins%20var/IMG-20251020-WA0005.jpg' },
  { id:'garlic1',    name:'Garlic paste 200g',     price:80,  image:'https://raw.githubusercontent.com/1collins/image/e88660bef9ec7d9770d55454ac4a1157a51ecca2/collins%20var/IMG-20251020-WA0007.jpg' },
  { id:'chicken1',   name:'Chicken 1kg',           price:450, image:'https://raw.githubusercontent.com/1collins/image/e88660bef9ec7d9770d55454ac4a1157a51ecca2/collins%20var/IMG-20251020-WA0008.jpg' },
  { id:'maize1',     name:'Maize meal 2kg',        price:150, image:'https://raw.githubusercontent.com/1collins/image/e88660bef9ec7d9770d55454ac4a1157a51ecca2/collins%20var/IMG-20251020-WA0009.jpg' },
  { id:'flour1',     name:'All-purpose flour 2kg', price:220, image:'https://raw.githubusercontent.com/1collins/image/e88660bef9ec7d9770d55454ac4a1157a51ecca2/collins%20var/IMG-20251020-WA0010.jpg' },
  { id:'oil1',       name:'Cooking oil 1L',        price:350, image:'https://raw.githubusercontent.com/1collins/image/e88660bef9ec7d9770d55454ac4a1157a51ecca2/collins%20var/IMG-20251020-WA0014.jpg' },
  { id:'noodles1',   name:'Instant noodles (1pc)', price:70,  image:'https://raw.githubusercontent.com/1collins/image/e88660bef9ec7d9770d55454ac4a1157a51ecca2/collins%20var/IMG-20251020-WA0015.jpg' },
  { id:'veg1',       name:'Mixed veg 500g',        price:120, image:'https://raw.githubusercontent.com/1collins/image/e88660bef9ec7d9770d55454ac4a1157a51ecca2/collins%20var/IMG-20251020-WA0016.jpg' }
];

/* ============================
   STATE (localStorage)
   ============================ */
const state = {
  cart: JSON.parse(localStorage.getItem('uk_cart') || '[]'),
  fridge: JSON.parse(localStorage.getItem('uk_fridge') || '[]'),
  planned: JSON.parse(localStorage.getItem('uk_planned') || '[]'),
  tokenPrice: Number(localStorage.getItem('uk_tokenPrice') || CONFIG.TOKEN_PRICE)
};

/* ============================
   Helpers & UI functions
   ============================ */
function saveState(){
  localStorage.setItem('uk_cart', JSON.stringify(state.cart));
  localStorage.setItem('uk_fridge', JSON.stringify(state.fridge));
  localStorage.setItem('uk_planned', JSON.stringify(state.planned));
  localStorage.setItem('uk_tokenPrice', String(state.tokenPrice));
  renderCart(); renderFridge(); renderCartCount();
}
function findShopById(id){ return shopItems.find(s => s.id === id) }
function blink(el){ if(!el) return; el.classList.add('blink'); setTimeout(()=>el.classList.remove('blink'),900); }
function escapeHtml(text){ return String(text||'').replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

/* Toast (non-blocking) */
function showToast(text){
  const t = document.getElementById('toast');
  t.textContent = text;
  t.classList.add('show');
  setTimeout(()=> t.classList.remove('show'), 1400);
}

/* ============================
   Render functions
   ============================ */
function renderQuickBar(){
  const quick = document.getElementById('quickItems');
  quick.innerHTML = '';
  const featured = CONFIG.featuredShopIds;
  featured.forEach(id=>{
    const s = findShopById(id);
    if(!s) return;
    const div = document.createElement('div'); div.className='quick-item';
    div.innerHTML = `<div style="font-size:13px">${escapeHtml(s.name)}</div><div style="font-weight:700">KES ${s.price}</div><div><button onclick="quickAddShop('${s.id}', this)" class="ghost">Add</button></div>`;
    quick.appendChild(div);
  });
}

function renderRecipes(){
  const el = document.getElementById('recipesGrid'); el.innerHTML = '';
  recipes.forEach(r=>{
    const card = document.createElement('div'); card.className='card';
    const ingHtml = r.ingredients.map(i=>`<div class="ingredient-row"><div>${escapeHtml(i.name)}</div><div>${i.shopId ? `<button class="ghost" onclick="addToFridge('${escapeHtml(i.name)}','${i.shopId}')">Add to Fridge</button>` : ''}</div></div>`).join('');
    card.innerHTML = `
      <img src="${r.image}" alt="${escapeHtml(r.title)}" onerror="this.src='https://via.placeholder.com/400x300?text=No+Image'">
      <h3>${escapeHtml(r.title)}</h3>
      <div class="buttons">
        <button class="ghost" onclick="toggleDetails('${r.id}')">View ingredients & steps</button>
        <button class="ghost" onclick="planRecipe('${r.id}', this)">Plan</button>
        <button onclick="sendRecipeWhatsApp('${r.id}', this)">Cook (WhatsApp)</button>
        <button class="ghost" onclick="addRecipeIngredientsToCart('${r.id}')">Add ingredients â†’ Shop</button>
      </div>
      <div id="details-${r.id}" class="hidden" style="margin-top:10px">
        <strong>Ingredients</strong>
        ${ingHtml}
        <strong style="display:block;margin-top:8px">Steps</strong>
        <ol style="margin:6px 0 0 18px">${r.steps.map(s=>`<li>${escapeHtml(s)}</li>`).join('')}</ol>
      </div>
    `;
    el.appendChild(card);
  });
}

function renderShop(){
  const el = document.getElementById('shopGrid'); el.innerHTML = '';
  shopItems.forEach(s=>{
    const card = document.createElement('div'); card.className='card shop-item'; card.id = 'shop-' + s.id;
    card.innerHTML = `
      <img src="${s.image}" alt="${escapeHtml(s.name)}" onerror="this.src='https://via.placeholder.com/400x300?text=No+Image'">
      <h4>${escapeHtml(s.name)}</h4>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
        <div style="font-weight:700">KES ${s.price}</div>
        <div style="display:flex;gap:8px;align-items:center">
          <button class="ghost" onclick="addToFridge('${escapeHtml(s.name)}','${s.id}')">Save</button>
          <button onclick="addShopToCart('${s.id}', this)">Add to cart</button>
        </div>
      </div>
    `;
    el.appendChild(card);
  });
}

function renderFridge(){
  const el = document.getElementById('fridgeList'); el.innerHTML = '';
  if(state.fridge.length === 0){ el.innerHTML = '<div class="card">Your fridge is empty.</div>'; return; }
  state.fridge.forEach(f=>{
    const c = document.createElement('div'); c.className='card';
    c.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"><div><strong>${escapeHtml(f.name)}</strong></div><div><button class="ghost" onclick="goToShop('${f.shopId}')">View in shop</button></div></div>`;
    el.appendChild(c);
  });
}

function renderCart(){
  const el = document.getElementById('cartItems'); el.innerHTML = '';
  if(state.cart.length === 0){ el.innerHTML = '<div class="card">Cart is empty</div>'; document.getElementById('cartTotal').innerText = 0; return; }
  let total = 0;
  state.cart.forEach((c, idx)=>{
    const row = document.createElement('div'); row.className='card'; row.style.display='flex'; row.style.justifyContent='space-between'; row.style.alignItems='center'; row.style.marginBottom='6px';
    row.innerHTML = `<div>${escapeHtml(c.name)} x ${c.qty}</div><div>${c.price * c.qty} KES <button class="ghost" onclick="removeCartItem(${idx})">Remove</button></div>`;
    el.appendChild(row);
    total += c.price * c.qty;
  });
  document.getElementById('cartTotal').innerText = total;
}

function renderCartCount(){
  const cnt = state.cart.reduce((s,i)=>s+i.qty,0);
  document.getElementById('cartCount').innerText = cnt;
}

/* ============================
   Actions
   ============================ */
function toggleDetails(id){
  const el = document.getElementById('details-' + id);
  if(!el) return;
  el.classList.toggle('hidden');
}

function planRecipe(id, btn){
  if(!state.planned.includes(id)) state.planned.push(id);
  saveState();
  blink(btn);
  showToast('Recipe added to plan');
}

function sendRecipeWhatsApp(id, btn){
  const r = recipes.find(x=>x.id===id); if(!r) return;
  const lines = [];
  lines.push(`ðŸ‘‹ Hello! I'd like to cook *${r.title}* today.`);
  lines.push('');
  lines.push('Ingredients:');
  r.ingredients.forEach(i => lines.push(`- ${i.name}`));
  lines.push('');
  lines.push('Steps (short):');
  r.steps.slice(0,6).forEach((s,i)=> lines.push(`${i+1}. ${s}`));
  blink(btn);
  showToast('Opening WhatsAppâ€¦');
  window.open(`https://wa.me/${CONFIG.PHONE}?text=${encodeURIComponent(lines.join('\n'))}`, '_blank');
}

function addRecipeIngredientsToCart(id){
  const r = recipes.find(x=>x.id===id); if(!r) return;
  r.ingredients.forEach(i=>{
    if(i.shopId){
      const s = findShopById(i.shopId);
      if(s){
        const existing = state.cart.find(c => c.id === s.id);
        if(existing) existing.qty++;
        else state.cart.push({ id: s.id, name: s.name, price: s.price, qty: 1 });
      }
    }
  });
  saveState();
  renderCart();
  showToast('Ingredients added to cart');
}

function addToFridge(name, shopId){
  if(!state.fridge.find(f=>f.name===name && f.shopId===shopId)) state.fridge.push({ name, shopId });
  saveState();
  switchTab('shop');
  setTimeout(()=> {
    const el = document.getElementById('shop-' + shopId);
    if(el){
      el.style.boxShadow = '0 8px 30px rgba(255,107,53,.18)';
      el.scrollIntoView({ behavior: 'smooth', block: 'center' });
      setTimeout(()=> el.style.boxShadow='', 900);
    }
  }, 300);
  showToast('Saved to fridge â€” opening shop');
}

function addShopToCart(shopId, btn){
  const s = findShopById(shopId); if(!s) return;
  const existing = state.cart.find(c => c.id === s.id);
  if(existing) existing.qty++;
  else state.cart.push({ id: s.id, name: s.name, price: s.price, qty: 1 });
  saveState();
  blink(btn);
  showToast('Added to cart');
}

function removeCartItem(index){ state.cart.splice(index,1); saveState(); renderCart(); }

document.getElementById('clearCart')?.addEventListener('click', ()=>{
  if(!confirm('Clear cart?')) return;
  state.cart = []; saveState(); renderCart();
});

/* Quick bar actions */
function renderQuickActions(){
  renderQuickBar();
  document.getElementById('quickAddGas').addEventListener('click', quickAddGas);
}
function quickAddShop(shopId, btn){ addShopToCart(shopId, btn); blink(btn); }
function quickAddGas(){ quickAddGasAction(); blink(document.getElementById('quickAddGas')); showToast('Gas added to cart'); }
function quickAddGasAction(){
  const qty = Number(document.getElementById('quickGasQty').value) || 1;
  const id = 'gas-token';
  const existing = state.cart.find(c => c.id === id);
  if(existing) existing.qty += qty;
  else state.cart.push({ id, name: `Gas tokens x${qty}`, price: state.tokenPrice, qty });
  saveState();
}

/* Gas tab */
const gasQtyEl = document.getElementById('gasQty');
const gasTotalEl = document.getElementById('gasTotal');
document.getElementById('tokenPrice').innerText = state.tokenPrice;
function updateGasTotal(){ gasTotalEl.innerText = (Number(gasQtyEl.value) || 1) * state.tokenPrice; }
gasQtyEl.addEventListener('input', updateGasTotal);
document.getElementById('addGas').addEventListener('click', ()=>{
  const qty = Number(gasQtyEl.value) || 1;
  const id = 'gas-token';
  const existing = state.cart.find(c => c.id === id);
  if(existing) existing.qty += qty;
  else state.cart.push({ id, name: `Gas tokens x${qty}`, price: state.tokenPrice, qty });
  saveState(); renderCart();
  showToast('Gas added to cart');
});

/* WhatsApp builders */
function buildCartMessage(){
  const lines = ['ðŸ›’ Unico Kitchen Order:'];
  if(state.cart.length === 0) lines.push('(Cart is empty)');
  state.cart.forEach(c => lines.push(`- ${c.name} x ${c.qty} = ${c.price * c.qty} KES`));
  const total = state.cart.reduce((s,i)=>s + i.price * i.qty, 0);
  lines.push(`Total: ${total} KES`);
  if(state.fridge.length > 0){
    lines.push('');
    lines.push('Saved fridge items:');
    state.fridge.forEach(f => lines.push(`- ${f.name}`));
  }
  return lines.join('\n');
}

function sendCartToWhatsApp(btn){
  blink(btn);
  const msg = buildCartMessage();
  showToast('Opening WhatsAppâ€¦');
  window.open(`https://wa.me/${CONFIG.PHONE}?text=${encodeURIComponent(msg)}`, '_blank');
}
document.getElementById('sendCart')?.addEventListener('click', function(){ sendCartToWhatsApp(this); });
document.getElementById('sendOrderHeader').addEventListener('click', function(){ sendCartToWhatsApp(this); });

function buildPlanMessage(){
  if(state.planned.length === 0) return 'Hello! I have no planned recipes yet.';
  const lines = ['Hello! I plan to cook:'];
  state.planned.forEach(id => {
    const r = recipes.find(rr => rr.id === id);
    if(r) lines.push(`- ${r.title}`);
  });
  return lines.join('\n');
}
document.getElementById('sendPlanHeader').addEventListener('click', function(){ blink(this); showToast('Opening WhatsAppâ€¦'); window.open(`https://wa.me/${CONFIG.PHONE}?text=${encodeURIComponent(buildPlanMessage())}`, '_blank'); });

/* Nav & utilities */
function switchTab(name){
  document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.dataset.tab === name));
  document.querySelectorAll('.tab-panel').forEach(p => p.classList.toggle('hidden', p.id !== name));
  if(name === 'shop') renderShop();
  if(name === 'recipes') renderRecipes();
  if(name === 'fridge') renderFridge();
  if(name === 'gas') updateGasTotal();
}
document.getElementById('navTabs').addEventListener('click', (e)=>{ if(e.target.dataset.tab) switchTab(e.target.dataset.tab); });

document.getElementById('openCartBtn').addEventListener('click', ()=>{
  const panel = document.getElementById('cartPanel');
  panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
  renderCart();
});

function goToShop(shopId){
  switchTab('shop');
  setTimeout(()=>{ const el = document.getElementById('shop-' + shopId); if(el){ el.style.boxShadow='0 8px 30px rgba(255,107,53,.18)'; el.scrollIntoView({behavior:'smooth',block:'center'}); setTimeout(()=>el.style.boxShadow='',900);} },200);
}

/* Init */
(function init(){
  state.tokenPrice = CONFIG.TOKEN_PRICE;
  document.getElementById('tokenPrice').innerText = state.tokenPrice;
  document.getElementById('gasTotal').innerText = state.tokenPrice * (Number(document.getElementById('gasQty').value) || 1);

  renderQuickActions();
  renderRecipes();
  renderShop();
  renderFridge();
  renderCart();
  renderCartCount();
})();
</script>
</body>
</html>
